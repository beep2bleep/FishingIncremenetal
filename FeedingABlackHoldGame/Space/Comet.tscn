[gd_scene load_steps=11 format=3 uid="uid://jihj2lwblq5n"]

[ext_resource type="Script" uid="uid://d3sk8yk2rlsin" path="res://Space/Comet.gd" id="1"]
[ext_resource type="PackedScene" uid="uid://dhfkn0yrcnpt4" path="res://Minions/LineTrail.tscn" id="2"]
[ext_resource type="Texture2D" uid="uid://c6puuqdi6eu44" path="res://Art/Circle.png" id="3"]
[ext_resource type="Texture2D" uid="uid://dqcd3v33ke3eb" path="res://Art/CRIT.png" id="4"]
[ext_resource type="PackedScene" uid="uid://qetgg583nnuo" path="res://CustomTweenComponent.tscn" id="5"]

[sub_resource type="Curve" id="Curve_2lpxp"]
_data = [Vector2(0, 0.04878044), 0.0, 0.0, 0, 0, Vector2(1, 1), 2.2861254, 0.0, 0, 0]
point_count = 2
metadata/_snap_count = 2

[sub_resource type="Curve" id="Curve_rmy0l"]
_data = [Vector2(0, 0.51196957), 0.0, 0.47388455, 0, 1, Vector2(1, 0.98585415), 0.47388455, 0.0, 1, 0]
point_count = 2

[sub_resource type="Gradient" id="Gradient_p4smm"]
offsets = PackedFloat32Array(0, 0, 0.16, 0.33, 0.5, 0.67, 0.83, 1)
colors = PackedColorArray(0.619608, 0.360784, 0.376471, 1, 0.788235, 0.478431, 0.298039, 1, 0.788235, 0.705882, 0.298039, 1, 0.298039, 0.619608, 0.376471, 1, 0.298039, 0.352941, 0.788235, 1, 0.290196, 0.309804, 0.701961, 1, 0.541176, 0.298039, 0.788235, 1, 0.54510003, 0.30020002, 0.79, 0)

[sub_resource type="Shader" id="Shader_sv868"]
resource_local_to_scene = true
code = "shader_type canvas_item;

render_mode blend_mix; // allows transparency blending

uniform float strength: hint_range(0., 1.) = 0.5;
uniform float speed: hint_range(0., 10.) = 0.5;
uniform float angle: hint_range(0., 360.) = 0.;
uniform float transparency: hint_range(0., 1.) = 0.5; // controls how see-through the effect is

void fragment() {
	float hue = UV.x * cos(radians(angle)) - UV.y * sin(radians(angle));
	hue = fract(hue + fract(TIME * speed));

	float x = 1. - abs(mod(hue / (1. / 6.), 2.) - 1.);
	vec3 rainbow;
	if (hue < 1. / 6.) {
		rainbow = vec3(1., x, 0.);
	} else if (hue < 1. / 3.) {
		rainbow = vec3(x, 1., 0.);
	} else if (hue < 0.5) {
		rainbow = vec3(0, 1., x);
	} else if (hue < 2. / 3.) {
		rainbow = vec3(0., x, 1.);
	} else if (hue < 5. / 6.) {
		rainbow = vec3(x, 0., 1.);
	} else {
		rainbow = vec3(1., 0., x);
	}

	vec4 base_color = texture(TEXTURE, UV);
	vec3 mixed = mix(base_color.rgb, rainbow, strength);

	// Apply transparency so the sprite behind can show through
	COLOR = vec4(mixed, base_color.a * (1.0 - transparency));
}
"

[sub_resource type="ShaderMaterial" id="ShaderMaterial_8lt70"]
resource_local_to_scene = true
shader = SubResource("Shader_sv868")
shader_parameter/strength = 0.5
shader_parameter/speed = 0.400000019
shader_parameter/angle = 270.000012825
shader_parameter/transparency = 0.0

[node name="Comet" type="Node2D"]
light_mask = 0
z_index = 3
script = ExtResource("1")
rotation_curve = SubResource("Curve_2lpxp")

[node name="Line Trail" parent="." instance=ExtResource("2")]
unique_name_in_owner = true
modulate = Color(1, 1, 1, 0.78431374)
width = 64.0
width_curve = SubResource("Curve_rmy0l")
default_color = Color(1, 1, 1, 1)
gradient = SubResource("Gradient_p4smm")

[node name="Pivot" type="Node2D" parent="."]
unique_name_in_owner = true

[node name="Art" type="Node2D" parent="Pivot"]
unique_name_in_owner = true

[node name="BaseSprite" type="Sprite2D" parent="Pivot/Art"]
unique_name_in_owner = true
material = SubResource("ShaderMaterial_8lt70")
scale = Vector2(0.5, 0.5)
texture = ExtResource("3")

[node name="Type Icon" type="Sprite2D" parent="Pivot/Art"]
unique_name_in_owner = true
visible = false
modulate = Color(0, 0, 0, 0.39215687)
scale = Vector2(0.67, 0.67)
texture = ExtResource("4")

[node name="CustomTweenComponent" parent="." node_paths=PackedStringArray("base_node") instance=ExtResource("5")]
unique_name_in_owner = true
base_node = NodePath("../Pivot/Art")
do_scale = true
scale_amount = Vector2(1.2, 1.2)
do_rotation = true
rotation_amount = 45

[node name="Buff Timer" type="Timer" parent="."]
unique_name_in_owner = true
wait_time = 5.0
one_shot = true

[connection signal="timeout" from="Buff Timer" to="." method="_on_buff_timer_timeout"]
